{"remainingRequest":"E:\\桌面\\csgo项目\\poetize-vue2\\node_modules\\babel-loader\\lib\\index.js!E:\\桌面\\csgo项目\\poetize-vue2\\node_modules\\cache-loader\\dist\\cjs.js??ref--1-0!E:\\桌面\\csgo项目\\poetize-vue2\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\桌面\\csgo项目\\poetize-vue2\\src\\components\\common\\uploadPicture.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\桌面\\csgo项目\\poetize-vue2\\src\\components\\common\\uploadPicture.vue","mtime":1681451078618},{"path":"E:\\桌面\\csgo项目\\poetize-vue2\\babel.config.js","mtime":1681451078527},{"path":"E:\\桌面\\csgo项目\\poetize-vue2\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\桌面\\csgo项目\\poetize-vue2\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"E:\\桌面\\csgo项目\\poetize-vue2\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\桌面\\csgo项目\\poetize-vue2\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLmNvbnN0cnVjdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnJlcGxhY2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zcGxpY2UuanMiOwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwpleHBvcnQgZGVmYXVsdCB7CiAgcHJvcHM6IHsKICAgIGlzQWRtaW46IHsKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogZmFsc2UKICAgIH0sCiAgICBwcmVmaXg6IHsKICAgICAgdHlwZTogU3RyaW5nLAogICAgICBkZWZhdWx0OiAiIgogICAgfSwKICAgIGxpc3RUeXBlOiB7CiAgICAgIHR5cGU6IFN0cmluZywKICAgICAgZGVmYXVsdDogInBpY3R1cmUiCiAgICB9LAogICAgYWNjZXB0OiB7CiAgICAgIHR5cGU6IFN0cmluZywKICAgICAgZGVmYXVsdDogImltYWdlLyoiCiAgICB9LAogICAgbWF4U2l6ZTogewogICAgICB0eXBlOiBOdW1iZXIsCiAgICAgIGRlZmF1bHQ6IDUKICAgIH0sCiAgICBtYXhOdW1iZXI6IHsKICAgICAgdHlwZTogTnVtYmVyLAogICAgICBkZWZhdWx0OiA1CiAgICB9CiAgfSwKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgcWluaXVQYXJhbTogewogICAgICAgIHRva2VuOiAiIiwKICAgICAgICBrZXk6ICIiCiAgICAgIH0KICAgIH07CiAgfSwKICBjb21wdXRlZDoge30sCiAgd2F0Y2g6IHt9LAogIGNyZWF0ZWQ6IGZ1bmN0aW9uIGNyZWF0ZWQoKSB7CiAgICBpZiAoIXRoaXMuaXNBZG1pbiAmJiAhdGhpcy4kY29tbW9uLmlzRW1wdHkodGhpcy4kc3RvcmUuc3RhdGUuY3VycmVudFVzZXIpIHx8IHRoaXMuaXNBZG1pbiAmJiAhdGhpcy4kY29tbW9uLmlzRW1wdHkodGhpcy4kc3RvcmUuc3RhdGUuY3VycmVudEFkbWluKSkgewogICAgICB0aGlzLmdldFVwVG9rZW4oKTsKICAgIH0KICB9LAogIG1vdW50ZWQ6IGZ1bmN0aW9uIG1vdW50ZWQoKSB7fSwKICBtZXRob2RzOiB7CiAgICBnZXRVcFRva2VuOiBmdW5jdGlvbiBnZXRVcFRva2VuKCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgdGhpcy4kaHR0cC5nZXQodGhpcy4kY29uc3RhbnQuYmFzZVVSTCArICIvcWluaXUvZ2V0VXBUb2tlbiIsIHt9LCB0aGlzLmlzQWRtaW4pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIGlmICghX3RoaXMuJGNvbW1vbi5pc0VtcHR5KHJlcy5kYXRhKSkgewogICAgICAgICAgX3RoaXMucWluaXVQYXJhbS50b2tlbiA9IHJlcy5kYXRhOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgX3RoaXMuJG1lc3NhZ2UoewogICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSwKICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAogICAgc3VibWl0VXBsb2FkOiBmdW5jdGlvbiBzdWJtaXRVcGxvYWQoKSB7CiAgICAgIHRoaXMuJHJlZnMudXBsb2FkLnN1Ym1pdCgpOwogICAgfSwKICAgIC8vIOaWh+S7tuS4iuS8oOaIkOWKn+aXtueahOmSqeWtkAogICAgaGFuZGxlU3VjY2VzczogZnVuY3Rpb24gaGFuZGxlU3VjY2VzcyhyZXNwb25zZSwgZmlsZSwgZmlsZUxpc3QpIHsKICAgICAgdGhpcy5xaW5pdVBhcmFtLmtleSA9ICIiOwogICAgICB2YXIgdXJsID0gdGhpcy4kY29uc3RhbnQucWluaXVEb3dubG9hZCArIHJlc3BvbnNlLmtleTsKICAgICAgdGhpcy4kY29tbW9uLnNhdmVSZXNvdXJjZSh0aGlzLCB0aGlzLnByZWZpeCwgdXJsLCBmaWxlLnNpemUsIGZpbGUucmF3LnR5cGUsIHRoaXMuaXNBZG1pbik7CiAgICAgIHRoaXMuJGVtaXQoImFkZFBpY3R1cmUiLCB1cmwpOwogICAgfSwKICAgIGhhbmRsZUVycm9yOiBmdW5jdGlvbiBoYW5kbGVFcnJvcihlcnIsIGZpbGUsIGZpbGVMaXN0KSB7CiAgICAgIHRoaXMucWluaXVQYXJhbS5rZXkgPSAiIjsKICAgICAgdGhpcy4kbWVzc2FnZSh7CiAgICAgICAgbWVzc2FnZTogIuS4iuS8oOWHuumUme+8gSIsCiAgICAgICAgdHlwZTogIndhcm5pbmciCiAgICAgIH0pOwogICAgfSwKICAgIC8vIOS4iuS8oOaWh+S7tuS5i+WJjeeahOmSqeWtkO+8jOWPguaVsOS4uuS4iuS8oOeahOaWh+S7tu+8jOiLpei/lOWbniBmYWxzZSDmiJbogIXov5Tlm54gUHJvbWlzZSDkuJTooqsgcmVqZWN077yM5YiZ5YGc5q2i5LiK5LygCiAgICBiZWZvcmVVcGxvYWQ6IGZ1bmN0aW9uIGJlZm9yZVVwbG9hZChmaWxlKSB7CiAgICAgIGlmICh0aGlzLiRjb21tb24uaXNFbXB0eSh0aGlzLnFpbml1UGFyYW0udG9rZW4pKSB7CiAgICAgICAgdGhpcy4kbWVzc2FnZSh7CiAgICAgICAgICBtZXNzYWdlOiAi5LiK5Lyg5Ye66ZSZ77yBIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIgogICAgICAgIH0pOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgdmFyIHN1ZmZpeCA9ICIiOwoKICAgICAgaWYgKGZpbGUubmFtZS5sYXN0SW5kZXhPZignLicpICE9PSAtMSkgewogICAgICAgIHN1ZmZpeCA9IGZpbGUubmFtZS5zdWJzdHJpbmcoZmlsZS5uYW1lLmxhc3RJbmRleE9mKCcuJykpOwogICAgICB9CgogICAgICB0aGlzLnFpbml1UGFyYW0ua2V5ID0gdGhpcy5wcmVmaXggKyAiLyIgKyAoIXRoaXMuJGNvbW1vbi5pc0VtcHR5KHRoaXMuJHN0b3JlLnN0YXRlLmN1cnJlbnRVc2VyLnVzZXJuYW1lKSA/IHRoaXMuJHN0b3JlLnN0YXRlLmN1cnJlbnRVc2VyLnVzZXJuYW1lLnJlcGxhY2UoL1teYS16QS1aXS9nLCAnJykgKyB0aGlzLiRzdG9yZS5zdGF0ZS5jdXJyZW50VXNlci5pZCA6IHRoaXMuJHN0b3JlLnN0YXRlLmN1cnJlbnRBZG1pbi51c2VybmFtZS5yZXBsYWNlKC9bXmEtekEtWl0vZywgJycpICsgdGhpcy4kc3RvcmUuc3RhdGUuY3VycmVudEFkbWluLmlkKSArIG5ldyBEYXRlKCkuZ2V0VGltZSgpICsgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwMCkgKyBzdWZmaXg7CiAgICB9LAogICAgLy8g5re75Yqg5paH5Lu244CB5LiK5Lyg5oiQ5Yqf5ZKM5LiK5Lyg5aSx6LSl5pe26YO95Lya6KKr6LCD55SoCiAgICBoYW5kbGVDaGFuZ2U6IGZ1bmN0aW9uIGhhbmRsZUNoYW5nZShmaWxlLCBmaWxlTGlzdCkgewogICAgICB2YXIgZmxhZyA9IGZhbHNlOyAvLyBpZiAoIS9pbWFnZVwvXHcrLy50ZXN0KGZpbGUudHlwZSkpIHsKICAgICAgLy8gICB0aGlzLiRtZXNzYWdlKHsKICAgICAgLy8gICAgIG1lc3NhZ2U6ICLlv4XpobvkuIrkvKDlm77niYfvvIEiLAogICAgICAvLyAgICAgdHlwZTogIndhcm5pbmciCiAgICAgIC8vICAgfSk7CiAgICAgIC8vICAgZmxhZyA9IHRydWU7CiAgICAgIC8vIH0KCiAgICAgIGlmIChmaWxlLnNpemUgPiB0aGlzLm1heFNpemUgKiAxMDI0ICogMTAyNCkgewogICAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgICAgbWVzc2FnZTogIuWbvueJh+acgOWkp+S4uiIgKyB0aGlzLm1heFNpemUgKyAiTe+8gSIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIKICAgICAgICB9KTsKICAgICAgICBmbGFnID0gdHJ1ZTsKICAgICAgfQoKICAgICAgaWYgKGZsYWcpIHsKICAgICAgICBmaWxlTGlzdC5zcGxpY2UoZmlsZUxpc3Quc2l6ZSAtIDEsIDEpOwogICAgICB9CiAgICB9CiAgfQp9Ow=="},{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkDA;EACAA;IACAC;MACAC,aADA;MAEAC;IAFA,CADA;IAKAC;MACAF,YADA;MAEAC;IAFA,CALA;IASAE;MACAH,YADA;MAEAC;IAFA,CATA;IAaAG;MACAJ,YADA;MAEAC;IAFA,CAbA;IAiBAI;MACAL,YADA;MAEAC;IAFA,CAjBA;IAqBAK;MACAN,YADA;MAEAC;IAFA;EArBA,CADA;EA4BAM,IA5BA,kBA4BA;IACA;MACAC;QACAC,SADA;QAEAC;MAFA;IADA;EAMA,CAnCA;EAqCAC,YArCA;EAuCAC,SAvCA;EAyCAC,OAzCA,qBAyCA;IACA;MACA;IACA;EACA,CA7CA;EA+CAC,OA/CA,qBA+CA,CAEA,CAjDA;EAmDAC;IACAC,UADA,wBACA;MAAA;;MACA,+EACAC,IADA,CACA;QACA;UACA;QACA;MACA,CALA,EAMAC,KANA,CAMA;QACA;UACAC,sBADA;UAEAnB;QAFA;MAIA,CAXA;IAYA,CAdA;IAeAoB,YAfA,0BAeA;MACA;IACA,CAjBA;IAkBA;IACAC,aAnBA,yBAmBAC,QAnBA,EAmBAC,IAnBA,EAmBAC,QAnBA,EAmBA;MACA;MACA;MACA;MACA;IACA,CAxBA;IAyBAC,WAzBA,uBAyBAC,GAzBA,EAyBAH,IAzBA,EAyBAC,QAzBA,EAyBA;MACA;MACA;QACAL,gBADA;QAEAnB;MAFA;IAIA,CA/BA;IAgCA;IACA2B,YAjCA,wBAiCAJ,IAjCA,EAiCA;MACA;QACA;UACAJ,gBADA;UAEAnB;QAFA;QAIA;MACA;;MAEA;;MACA;QACA4B;MACA;;MAEA;IACA,CAhDA;IAiDA;IACAC,YAlDA,wBAkDAN,IAlDA,EAkDAC,QAlDA,EAkDA;MACA,iBADA,CAEA;MACA;MACA;MACA;MACA;MACA;MACA;;MAEA;QACA;UACAL,sCADA;UAEAnB;QAFA;QAIA8B;MACA;;MAEA;QACAN;MACA;IACA;EAvEA;AAnDA","names":["props","isAdmin","type","default","prefix","listType","accept","maxSize","maxNumber","data","qiniuParam","token","key","computed","watch","created","mounted","methods","getUpToken","then","catch","message","submitUpload","handleSuccess","response","file","fileList","handleError","err","beforeUpload","suffix","handleChange","flag"],"sourceRoot":"src/components/common","sources":["uploadPicture.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <el-upload\r\n      class=\"upload-demo\"\r\n      ref=\"upload\"\r\n      multiple\r\n      drag\r\n      :action=\"$constant.qiniuUrl\"\r\n      :data=\"qiniuParam\"\r\n      :on-change=\"handleChange\"\r\n      :before-upload=\"beforeUpload\"\r\n      :on-success=\"handleSuccess\"\r\n      :on-error=\"handleError\"\r\n      :list-type=\"listType\"\r\n      :accept=\"accept\"\r\n      :limit=\"maxNumber\"\r\n      :auto-upload=\"false\">\r\n      <div class=\"el-upload__text\">\r\n        <svg viewBox=\"0 0 1024 1024\" width=\"40\" height=\"40\">\r\n          <path\r\n            d=\"M666.2656 629.4528l-113.7664-112.4864c-20.7872-20.5824-54.3232-20.5312-75.1104 0.1024l-113.3056 112.4864c-20.8896 20.736-21.0432 54.528-0.256 75.4688 20.736 20.8896 54.528 21.0432 75.4688 0.256l22.6304-22.4256v189.5936c0 29.44 23.9104 53.3504 53.3504 53.3504s53.3504-23.9104 53.3504-53.3504v-189.5424l22.6816 22.4256a53.1456 53.1456 0 0 0 37.5296 15.4112c13.7728 0 27.4944-5.2736 37.9392-15.8208 20.6336-20.9408 20.4288-54.7328-0.512-75.4688z\"\r\n            fill=\"#FFE37B\"></path>\r\n          <path\r\n            d=\"M820.992 469.504h-5.376c-3.072-163.328-136.3456-294.8096-300.4416-294.8096S217.856 306.1248 214.784 469.504H209.408c-100.7104 0-182.3744 81.664-182.3744 182.3744s81.664 182.3744 182.3744 182.3744h209.7664V761.856c-30.208 5.5808-62.464-3.3792-85.6576-26.7264-37.3248-37.5808-37.0688-98.5088 0.512-135.7824l113.3056-112.4864c37.2224-36.9664 97.8432-37.0176 135.168-0.1536l113.7664 112.4864c18.2272 18.0224 28.3648 42.0864 28.5184 67.7376 0.1536 25.6512-9.728 49.8176-27.7504 68.0448a95.40096 95.40096 0 0 1-68.3008 28.5184c-5.9392 0-11.776-0.512-17.5104-1.5872v72.3456h209.7664c100.7104 0 182.3744-81.664 182.3744-182.3744S921.7024 469.504 820.992 469.504z\"\r\n            fill=\"#8C7BFD\"></path>\r\n        </svg>\r\n        <div>拖拽上传 / 点击上传</div>\r\n      </div>\r\n      <template v-if=\"listType === 'picture'\">\r\n        <div slot=\"tip\" class=\"el-upload__tip\">\r\n          一次最多上传{{maxNumber}}张图片，且每张图片不超过{{maxSize}}M！\r\n        </div>\r\n      </template>\r\n      <template v-else>\r\n        <div slot=\"tip\" class=\"el-upload__tip\">\r\n          一次最多上传{{maxNumber}}个文件，且每个文件不超过{{maxSize}}M！\r\n        </div>\r\n      </template>\r\n\r\n    </el-upload>\r\n\r\n    <div style=\"text-align: center;margin-top: 20px\">\r\n      <el-button type=\"success\" style=\"font-size: 12px\" @click=\"submitUpload\">\r\n        上传\r\n      </el-button>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  export default {\r\n    props: {\r\n      isAdmin: {\r\n        type: Boolean,\r\n        default: false\r\n      },\r\n      prefix: {\r\n        type: String,\r\n        default: \"\"\r\n      },\r\n      listType: {\r\n        type: String,\r\n        default: \"picture\"\r\n      },\r\n      accept: {\r\n        type: String,\r\n        default: \"image/*\"\r\n      },\r\n      maxSize: {\r\n        type: Number,\r\n        default: 5\r\n      },\r\n      maxNumber: {\r\n        type: Number,\r\n        default: 5\r\n      }\r\n    },\r\n\r\n    data() {\r\n      return {\r\n        qiniuParam: {\r\n          token: \"\",\r\n          key: \"\"\r\n        }\r\n      }\r\n    },\r\n\r\n    computed: {},\r\n\r\n    watch: {},\r\n\r\n    created() {\r\n      if ((!this.isAdmin && !this.$common.isEmpty(this.$store.state.currentUser)) || (this.isAdmin && !this.$common.isEmpty(this.$store.state.currentAdmin))) {\r\n        this.getUpToken();\r\n      }\r\n    },\r\n\r\n    mounted() {\r\n\r\n    },\r\n\r\n    methods: {\r\n      getUpToken() {\r\n        this.$http.get(this.$constant.baseURL + \"/qiniu/getUpToken\", {}, this.isAdmin)\r\n          .then((res) => {\r\n            if (!this.$common.isEmpty(res.data)) {\r\n              this.qiniuParam.token = res.data;\r\n            }\r\n          })\r\n          .catch((error) => {\r\n            this.$message({\r\n              message: error.message,\r\n              type: \"error\"\r\n            });\r\n          });\r\n      },\r\n      submitUpload() {\r\n        this.$refs.upload.submit();\r\n      },\r\n      // 文件上传成功时的钩子\r\n      handleSuccess(response, file, fileList) {\r\n        this.qiniuParam.key = \"\";\r\n        let url = this.$constant.qiniuDownload + response.key;\r\n        this.$common.saveResource(this, this.prefix, url, file.size, file.raw.type, this.isAdmin);\r\n        this.$emit(\"addPicture\", url);\r\n      },\r\n      handleError(err, file, fileList) {\r\n        this.qiniuParam.key = \"\";\r\n        this.$message({\r\n          message: \"上传出错！\",\r\n          type: \"warning\"\r\n        });\r\n      },\r\n      // 上传文件之前的钩子，参数为上传的文件，若返回 false 或者返回 Promise 且被 reject，则停止上传\r\n      beforeUpload(file) {\r\n        if (this.$common.isEmpty(this.qiniuParam.token)) {\r\n          this.$message({\r\n            message: \"上传出错！\",\r\n            type: \"warning\"\r\n          });\r\n          return false;\r\n        }\r\n\r\n        let suffix = \"\";\r\n        if (file.name.lastIndexOf('.') !== -1) {\r\n          suffix = file.name.substring(file.name.lastIndexOf('.'));\r\n        }\r\n\r\n        this.qiniuParam.key = this.prefix + \"/\" + (!this.$common.isEmpty(this.$store.state.currentUser.username) ? (this.$store.state.currentUser.username.replace(/[^a-zA-Z]/g, '') + this.$store.state.currentUser.id) : (this.$store.state.currentAdmin.username.replace(/[^a-zA-Z]/g, '') + this.$store.state.currentAdmin.id)) + new Date().getTime() + Math.floor(Math.random() * 1000) + suffix;\r\n      },\r\n      // 添加文件、上传成功和上传失败时都会被调用\r\n      handleChange(file, fileList) {\r\n        let flag = false;\r\n        // if (!/image\\/\\w+/.test(file.type)) {\r\n        //   this.$message({\r\n        //     message: \"必须上传图片！\",\r\n        //     type: \"warning\"\r\n        //   });\r\n        //   flag = true;\r\n        // }\r\n\r\n        if (file.size > this.maxSize * 1024 * 1024) {\r\n          this.$message({\r\n            message: \"图片最大为\" + this.maxSize + \"M！\",\r\n            type: \"warning\"\r\n          });\r\n          flag = true;\r\n        }\r\n\r\n        if (flag) {\r\n          fileList.splice(fileList.size - 1, 1);\r\n        }\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style scoped>\r\n\r\n</style>\r\n"]}]}